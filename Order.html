<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      //  If user is NOT logged in, go to login page
      if (localStorage.getItem("isLoggedIn") !== "true") {
        window.location.href = "login.html";
      }
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Order - H2GO JAAM Water</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-dark navbar-dark">
      <div class="container">
        <a href="index.html" class="navbar-brand">H2GO</a>
        <!-- Placeholder for login/logout -->
        <span id="auth-button" class="ms-auto"></span>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navmenu"
        >hi
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navmenu">
          <ul class="navbar-nav ms-auto" id="navLinks">
            <!-- Navigation links will be added by JavaScript -->
          </ul>
        </div>
      </div>
    </nav>

    <!-- Order Form -->
    <div class="container my-5">
      <h1>Place Your Order</h1>
      <form onsubmit="saveOrder(event)">
        <div class="mb-3">
          <label for="roomNumber" class="form-label">Room Number</label>
          <input
            type="text"
            class="form-control"
            id="roomNumber"
            placeholder=""
          />
        </div>

        <div class="mb-3">
          <label for="bottleSize" class="form-label">Select Bottle Size</label>
          <select class="form-select" id="bottleSize" required>
            <option value="">-- Select Bottle Size --</option>
            <option value="0.5L">0.5 Liter</option>
            <option value="1.5L">1.5 Liter</option>
            <option value="5L">5 Liter</option>
            <option value="10L">10 Liter</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="quantity" class="form-label">Number of Packs</label>
          <input
            type="number"
            id="quantity"
            class="form-control"
            min="1"
            required
            placeholder="Enter number of packs"
          />
        </div>

        <div class="mb-3">
          <label for="deliverySchedule" class="form-label"
            >Select Delivery Time</label
          >
          <select class="form-select" id="deliverySchedule">
            <option value="Sun-Morning">Tuesday</option>
            <option value="Sun-Afternoon">Thursday</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Payment Method</label><br />
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="payment"
              id="cash"
              value="Cash"
              checked
            />
            <label class="form-check-label" for="cash">Cash</label>
          </div>
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              name="payment"
              id="mastercard"
              value="Mastercard"
            />
            <label class="form-check-label" for="mastercard">Mastercard</label>
          </div>
        </div>
        <div id="cardInfo" class="mb-3" style="display: none">
          <label for="cardNumber" class="form-label">Card Number</label>
          <input
            type="text"
            class="form-control mb-2"
            id="cardNumber"
            placeholder="Enter your card number"
          />

          <label for="cardName" class="form-label">Name on Card</label>
          <input
            type="text"
            class="form-control mb-2"
            id="cardName"
            placeholder="Enter cardholder's name"
          />

          <label for="expiryDate" class="form-label">Expiry Date</label>
          <input type="month" class="form-control mb-2" id="expiryDate" />

          <label for="cvv" class="form-label">CVV</label>
          <input
            type="password"
            class="form-control"
            id="cvv"
            placeholder="CVV"
            maxlength="4"
          />
        </div>

        <div class="mb-3">
          <label for="orderDetails" class="form-label">Additional Notes</label>
          <textarea
            class="form-control"
            id="orderDetails"
            rows="3"
            placeholder="Optional notes"
          ></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Submit Order</button>


        </div>
      </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Logout Confirmation Modal -->
    <div
      id="logoutModal"
      class="modal"
      tabindex="-1"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9999;
      "
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4">
          <h5 class="mb-3">Are you sure you want to logout?</h5>
          <div class="text-end">
            <button class="btn btn-secondary me-2" onclick="closeLogoutModal()">
              No
            </button>
            <button class="btn btn-danger" onclick="confirmLogout()">
              Yes
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // âœ… Dynamic Navigation Based on Role
      window.onload = function () {
        const role = localStorage.getItem("role");
        const navLinks = document.getElementById("navLinks");
        const authArea = document.getElementById("auth-button");

        // Set auth button (login/logout)
        if (localStorage.getItem("isLoggedIn") === "true") {
          authArea.innerHTML = `<a href="#" class="btn btn-outline-warning" onclick="logout()">Logout</a>`;
        } else {
          authArea.innerHTML = `<a
          href="login.html" class="btn btn-outline-light">Login</>`;
        }

        // Set navigation items
        if (role === "admin") {
          navLinks.innerHTML = `
        <li class="nav-item">
          <a href="admin.html" class="nav-link">Dashboard</a>
        </li>
      `;
        } else {
          navLinks.innerHTML = `
        <li class="nav-item">
          <a href="feedback.html" class="nav-link">Feedback</a>
        </li>
        
      `;
        }
      };

      function logout() {
        localStorage.clear();
        window.location.href = "login.html";
      }
    </script>

    <script>
      function saveOrder(e) {
        e.preventDefault();

        const room = document.getElementById("roomNumber").value;
        const size = document.getElementById("bottleSize").value;
        const quantity = parseInt(
          document.getElementById("quantity").value,
          10
        );
        const delivery = document.getElementById("deliverySchedule").value;
        const payment =
          document.querySelector('input[name="payment"]:checked')?.value || "";
        const notes = document.getElementById("orderDetails").value;
        const email = localStorage.getItem("userEmail") || "Unknown";
        const time = new Date().toLocaleString();

        const prices = {
          "0.5L": 1250,
          "1.5L": 1750,
          "5L": 2500,
          "10L": 3500,
        };

        const price = prices[size] * quantity;

        // Save data temporarily for confirmation page
        const orderSummary = {
          room,
          size,
          quantity,
          delivery,
          payment,
          notes,
          email,
          time,
          price,
        };

        localStorage.setItem("latestOrder", JSON.stringify(orderSummary));

        // Redirect to confirmation page
        window.location.href = "confirmation.html";
      }
    </script>

    localStorage.setItem("userEmail", email);

    <script>
      const cashRadio = document.getElementById("cash");
      const cardRadio = document.getElementById("mastercard");
      const cardInfoDiv = document.getElementById("cardInfo");

      // Run whenever a payment option changes
      function toggleCardFields() {
        if (cardRadio.checked) {
          cardInfoDiv.style.display = "block";
        } else {
          cardInfoDiv.style.display = "none";
        }
      }

      // Set listeners
      cashRadio.addEventListener("change", toggleCardFields);
      cardRadio.addEventListener("change", toggleCardFields);

      // Run once on load in case it's pre-selected
      toggleCardFields();
    </script>
  </body>
</html>

